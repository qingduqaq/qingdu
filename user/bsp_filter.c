#include "bsp_filter.h"
#include "bsp_math.h"
#include "bsp_usart.h"

float const param[15][15] = {{0.990608875128850, 0.0429308565531050, -0.0610939112487444, 0.00825593395250363, 0.0342621259029904, 0.00825593395254461, -0.0206398348813030, -0.0206398348813169, 0.00257997936015262, 0.0206398348813043,	0.0119711042311641, -0.0140350877192740, -0.0183694530443256, 0.0206398348814056,	-0.00536635706893190},
{0.0429308565531201, 0.797420020639749, 0.310423116615097,	-0.0883384932919961,	-0.140350877192979,	-0.0103199174407137,	0.0908152734777560,	0.0722394220846148,	-0.0206398348812762,	-0.0799793601650637,	-0.0388028895768728,	0.0565531475747757,	0.0652218782249429,	-0.0778121775025141,	0.0206398348813478},
{-0.0610939112487999,	0.310423116615072,	0.445336191156588,	0.323759625307574,	0.103707231880608,	-0.0603318250376711,	-0.0992299753909324,	-0.0377867746288801,	0.0436611891719911,	0.0682702230689487,	0.0160435024212107,	-0.0548067000078978,	-0.0448043184884887,	0.0652218782249734,	-0.0183694530442791},
{0.00825593395249603,	-0.0883384932920019,	0.323759625307576,	0.474009684845544,	0.321092323569102,	0.0730332618878011,	-0.0825593395252320,	-0.0861316186393516,	0.000317535921208536,	0.0658887036595497,	0.0415972056838832,	-0.0386361832181835,	-0.0548067000079001,	0.0565531475747827,	-0.0140350877192712},
{0.0342621259029933,	-0.140350877192979,	0.103707231880610,	0.321092323569102,	0.369984917043735,	0.273080892275934,	0.117488290862905,	-0.0111137572437814,	-0.0646979439549016,	-0.0441374930538987,	0.00987536715090330,	0.0415972056838828,	0.0160435024212083,	-0.0388028895768736,	0.0119711042311561},
{0.00825593395254179,	-0.0103199174407154,	-0.0603318250376712,	0.0730332618878012,	0.273080892275934,	0.377986822259215,	0.317535921251043,	0.138921965547354,	-0.0396919901563363,	-0.109152972930010,	-0.0441374930538988,	0.0658887036595496,	0.0682702230689482,	-0.0799793601650624,	0.0206398348813064},
{-0.0206398348813011,	0.0908152734777566,	-0.0992299753909318,	-0.0825593395252317,	0.117488290862905,	0.317535921251043,	0.377986822259219,	0.277843931094700,	0.0992299753910084,	-0.0396919901563363,	-0.0646979439549017,	0.000317535921208562,	0.0436611891719907,	-0.0206398348812764,	0.00257997936015079},
{-0.0206398348813169,	0.0722394220846148,	-0.0377867746288801,	-0.0861316186393516,	-0.0111137572437814,	0.138921965547354,	0.277843931094700,	0.333333333333325,	0.277843931094700,	0.138921965547354,	-0.0111137572437814,	-0.0861316186393516,	-0.0377867746288801,	0.0722394220846148,	-0.0206398348813169},
{0.00257997936015115,	-0.0206398348812763,	0.0436611891719906,	0.000317535921208562,	-0.0646979439549017,	-0.0396919901563363,	0.0992299753910084,	0.277843931094700,	0.377986822259219,	0.317535921251043,	0.117488290862905,	-0.0825593395252317,	-0.0992299753909319,	0.0908152734777570,	-0.0206398348813015},
{0.0206398348813058,	-0.0799793601650624,	0.0682702230689480,	0.0658887036595496,	-0.0441374930538988,	-0.109152972930010,	-0.0396919901563363,	0.138921965547354,	0.317535921251043,	0.377986822259215,	0.273080892275934,	0.0730332618878012,	-0.0603318250376710,	-0.0103199174407150,	0.00825593395254148},
{0.0119711042311559,	-0.0388028895768737,	0.0160435024212082,	0.0415972056838828,	0.00987536715090330,	-0.0441374930538987,	-0.0646979439549016,	-0.0111137572437814,	0.117488290862905,	0.273080892275934,	0.369984917043735,	0.321092323569102,	0.103707231880610,	-0.140350877192979,	0.0342621259029935},
{-0.0140350877192709,	0.0565531475747829,	-0.0548067000078999,	-0.0386361832181835,	0.0415972056838832,	0.0658887036595497,	0.000317535921208536,	-0.0861316186393516,	-0.0825593395252320,	0.0730332618878011,	0.321092323569102,	0.474009684845544,	0.323759625307576,	-0.0883384932920016,	0.00825593395249481},
{-0.0183694530442790,	0.0652218782249735,	-0.0448043184884888,	-0.0548067000078978,	0.0160435024212107,	0.0682702230689487,	0.0436611891719911,	-0.0377867746288801,	-0.0992299753909324,	-0.0603318250376711,	0.103707231880608,	0.323759625307574,	0.445336191156588,	0.310423116615073,	-0.0610939112487991},
{0.0206398348813473,	-0.0778121775025140,	0.0652218782249429, 0.0565531475747757,	-0.0388028895768728,	-0.0799793601650637,	-0.0206398348812762,	0.0722394220846148,	0.0908152734777560,	-0.0103199174407137,	-0.140350877192979,	-0.0883384932919961,	0.310423116615097,	0.797420020639750,	0.0429308565531207},
{-0.00536635706893197,	0.0206398348814054,	-0.0183694530443256,	-0.0140350877192740,	0.0119711042311641,	0.0206398348813043,	0.00257997936015262,	-0.0206398348813169,	-0.0206398348813030,	0.00825593395254461,	0.0342621259029904,	0.00825593395250363,	-0.0610939112487443,	0.0429308565531047,	0.990608875128851}};

void SG_Filter(float data)
{
	uint8_t i, i1;
	int a1, a2, a3, a4;
	static uint8_t count;
	static float Array[Filter_Num];
	static uint16_t Output[Filter_Num];
	
	Array[count] = data;
	if(count >= 14)
	{
		for(i = 0; i < 15; i++)
		{
			for(i1 = 0; i1 < 15; i1++)
		  {
				Output[i] += (int)(Array[i1] * param[i][i1]);
			}
		Rate_Calculate(Output[i]);
		a1 = Output[i] / 1000;
		a2 = Output[i] % 1000 / 100;
		a3 = Output[i] % 1000 % 100 / 10;
		a4 = Output[i] % 1000 % 100 % 10;
		printf("AAA%d%d%d%d", a1, a2, a3, a4);
		}			
		for(i = 0; i < 15; i++)
		{
			Output[i] = 0;
		}
		count = 0;
	}
	else
	{
		count++;
	}
}
